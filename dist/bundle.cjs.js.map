{"version":3,"file":"bundle.cjs.js","sources":["../src/index.js"],"sourcesContent":["import Promise from 'bluebird';\nimport _ from 'lodash';\n\nfunction lift(done) {\n  let self = this;\n  let pins = [];\n\n  _.each(self.config.routes, (action, key) => {\n    let index = key.indexOf(' ');\n    let keyParts = [key.slice(0, index), key.slice(index + 1)];\n    let method = (keyParts[0] || '').toLowerCase();\n    let pattern = keyParts[1];\n\n    if (!_.includes(['add', 'wrap'], method)) {\n      throw new Error(`invalid route method: ${method}`);\n    }\n\n    let actionParts = action.split('.');\n    let controllerName = actionParts[0];\n    let controller = self.controllers[controllerName];\n    if (!controller) {\n      throw new Error(`undefined controller: ${controllerName}`);\n    }\n\n    let actionMethodName = actionParts[1];\n    let actionMethod = controller[actionMethodName];\n    if (!actionMethod) {\n      throw new Error(`undefined action method: ${action}`);\n    }\n    pins.push(`{${pattern}}`);\n    self.seneca[method](pattern, actionMethod);\n  });\n\n  let senecaConnectionName = _.merge({}, self.config.seneca, (self.config.seneca || {}).route)\n    .connection;\n  let senecaConnection = self.config.connections[senecaConnectionName];\n  if (senecaConnectionName && !senecaConnection) {\n    throw new Error(`unknown seneca connection:${senecaConnectionName}`);\n  }\n\n  if (!senecaConnection.options.pins && !senecaConnection.options.pin) {\n    senecaConnection.options.pin = `[${pins.join(',')}]`;\n  }\n  if (senecaConnection.transport) {\n    self.seneca.use(senecaConnection.transport);\n  }\n  self.seneca.listen(senecaConnection.options);\n  process.nextTick(done);\n}\n\nexport default Promise.promisify(lift);\n"],"names":["lift","done","self","pins","each","config","routes","action","key","index","indexOf","keyParts","slice","method","toLowerCase","pattern","_","includes","Error","actionParts","split","controllerName","controller","controllers","actionMethodName","actionMethod","push","seneca","senecaConnectionName","merge","route","connection","senecaConnection","connections","options","pin","join","transport","use","listen","nextTick","Promise","promisify"],"mappings":";;;;;;;AAGA,SAASA,IAAT,CAAcC,IAAd,EAAoB;MACdC,OAAO,IAAX;MACIC,OAAO,EAAX;;IAEEC,IAAF,CAAOF,KAAKG,MAAL,CAAYC,MAAnB,EAA2B,CAACC,MAAD,EAASC,GAAT,KAAiB;QACtCC,QAAQD,IAAIE,OAAJ,CAAY,GAAZ,CAAZ;QACIC,WAAW,CAACH,IAAII,KAAJ,CAAU,CAAV,EAAaH,KAAb,CAAD,EAAsBD,IAAII,KAAJ,CAAUH,QAAQ,CAAlB,CAAtB,CAAf;QACII,SAAS,CAACF,SAAS,CAAT,KAAe,EAAhB,EAAoBG,WAApB,EAAb;QACIC,UAAUJ,SAAS,CAAT,CAAd;;QAEI,CAACK,EAAEC,QAAF,CAAW,CAAC,KAAD,EAAQ,MAAR,CAAX,EAA4BJ,MAA5B,CAAL,EAA0C;YAClC,IAAIK,KAAJ,CAAW,yBAAwBL,MAAO,EAA1C,CAAN;;;QAGEM,cAAcZ,OAAOa,KAAP,CAAa,GAAb,CAAlB;QACIC,iBAAiBF,YAAY,CAAZ,CAArB;QACIG,aAAapB,KAAKqB,WAAL,CAAiBF,cAAjB,CAAjB;;QACI,CAACC,UAAL,EAAiB;YACT,IAAIJ,KAAJ,CAAW,yBAAwBG,cAAe,EAAlD,CAAN;;;QAGEG,mBAAmBL,YAAY,CAAZ,CAAvB;QACIM,eAAeH,WAAWE,gBAAX,CAAnB;;QACI,CAACC,YAAL,EAAmB;YACX,IAAIP,KAAJ,CAAW,4BAA2BX,MAAO,EAA7C,CAAN;;;SAEGmB,IAAL,CAAW,IAAGX,OAAQ,GAAtB;SACKY,MAAL,CAAYd,MAAZ,EAAoBE,OAApB,EAA6BU,YAA7B;GAvBF;;MA0BIG,uBAAuBZ,EAAEa,KAAF,CAAQ,EAAR,EAAY3B,KAAKG,MAAL,CAAYsB,MAAxB,EAAgC,CAACzB,KAAKG,MAAL,CAAYsB,MAAZ,IAAsB,EAAvB,EAA2BG,KAA3D,EACxBC,UADH;;MAEIC,mBAAmB9B,KAAKG,MAAL,CAAY4B,WAAZ,CAAwBL,oBAAxB,CAAvB;;MACIA,wBAAwB,CAACI,gBAA7B,EAA+C;UACvC,IAAId,KAAJ,CAAW,6BAA4BU,oBAAqB,EAA5D,CAAN;;;MAGE,CAACI,iBAAiBE,OAAjB,CAAyB/B,IAA1B,IAAkC,CAAC6B,iBAAiBE,OAAjB,CAAyBC,GAAhE,EAAqE;qBAClDD,OAAjB,CAAyBC,GAAzB,GAAgC,IAAGhC,KAAKiC,IAAL,CAAU,GAAV,CAAe,GAAlD;;;MAEEJ,iBAAiBK,SAArB,EAAgC;SACzBV,MAAL,CAAYW,GAAZ,CAAgBN,iBAAiBK,SAAjC;;;OAEGV,MAAL,CAAYY,MAAZ,CAAmBP,iBAAiBE,OAApC;UACQM,QAAR,CAAiBvC,IAAjB;;;AAGF,YAAewC,QAAQC,SAAR,CAAkB1C,IAAlB,CAAf;;;;"}